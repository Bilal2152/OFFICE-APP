<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Secretariat Task Log</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        slate: {
                            50: '#f8fafc', 800: '#1e293b', 900: '#0f172a',
                        }
                    }
                }
            }
        }
    </script>

    <style>
        /* Custom scrollbar */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 4px; }
        .dark ::-webkit-scrollbar-thumb { background: #334155; }

        /* Print Overrides: Forces light mode look on paper */
        @media print {
            @page { margin: 1cm; size: landscape; }
            body { -webkit-print-color-adjust: exact; background-color: white !important; color: black !important; }
            .no-print { display: none !important; }
            
            /* Hide Sidebar and Toast */
            aside, .toast-container, button { display: none !important; }
            
            /* Reset Colors for Ink Saving */
            .bg-slate-900, .bg-slate-800, .bg-slate-700 { background-color: white !important; color: black !important; border-color: #ccc !important; }
            .text-slate-100, .text-slate-300, .text-slate-400 { color: black !important; }
            
            /* Expand content width */
            main { padding: 0 !important; width: 100% !important; margin: 0 !important; }
            
            /* Borders */
            .border, .border-b, .border-t { border-color: #000 !important; }
        }

        /* Toast Animation */
        .toast-enter { transform: translateY(100%); opacity: 0; }
        .toast-enter-active { transform: translateY(0); opacity: 1; transition: all 300ms ease-out; }
        .toast-exit { transform: translateY(0); opacity: 1; }
        .toast-exit-active { transform: translateY(100%); opacity: 0; transition: all 300ms ease-in; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // --- Icons (Lucide-React Replicas) ---
        const Icon = ({ children, size = 24, className = "" }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>{children}</svg>
        );
        const Plus = (p) => <Icon {...p}><path d="M5 12h14"/><path d="M12 5v14"/></Icon>;
        const Trash2 = (p) => <Icon {...p}><path d="M3 6h18"/><path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"/><path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"/><line x1="10" y1="11" x2="10" y2="17"/><line x1="14" y1="11" x2="14" y2="17"/></Icon>;
        const CheckCircle = (p) => <Icon {...p}><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><polyline points="22 4 12 14.01 9 11.01"/></Icon>;
        const FileSpreadsheet = (p) => <Icon {...p}><path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"/><polyline points="14 2 14 8 20 8"/><path d="M8 13h2"/><path d="M8 17h2"/><path d="M14 13h2"/><path d="M14 17h2"/></Icon>;
        const LayoutDashboard = (p) => <Icon {...p}><rect x="3" y="3" width="7" height="9"/><rect x="14" y="3" width="7" height="5"/><rect x="14" y="12" width="7" height="9"/><rect x="3" y="16" width="7" height="5"/></Icon>;
        const ListTodo = (p) => <Icon {...p}><rect x="3" y="5" width="6" height="6" rx="1"/><path d="m3 17 2 2 4-4"/><path d="M13 6h8"/><path d="M13 12h8"/><path d="M13 18h8"/></Icon>;
        const AlertCircle = (p) => <Icon {...p}><circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="12"/><line x1="12" y1="16" x2="12.01" y2="16"/></Icon>;
        const Search = (p) => <Icon {...p}><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></Icon>;
        const Printer = (p) => <Icon {...p}><polyline points="6 9 6 2 18 2 18 9"/><path d="M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2"/><rect x="6" y="14" width="12" height="8"/></Icon>;
        const Shield = (p) => <Icon {...p}><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/></Icon>;
        const Archive = (p) => <Icon {...p}><polyline points="21 8 21 21 3 21 3 8"/><rect x="1" y="3" width="22" height="5"/><line x1="10" y1="12" x2="14" y2="12"/></Icon>;
        const Copy = (p) => <Icon {...p}><rect x="9" y="9" width="13" height="13" rx="2" ry="2"/><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/></Icon>;
        const Moon = (p) => <Icon {...p}><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/></Icon>;
        const Sun = (p) => <Icon {...p}><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></Icon>;

        // --- Main App ---
        function App() {
            const [activeTab, setActiveTab] = useState('tasks');
            const [searchQuery, setSearchQuery] = useState('');
            const [darkMode, setDarkMode] = useState(false);
            const [toast, setToast] = useState(null); // Toast State

            // Sample Data
            const [tasks, setTasks] = useState([
                { id: 1, letterNo: 'SEC/CONF/2023-01', date: '2023-11-01', subject: 'Meeting Minutes Approval', assignedTo: 'Private Secretary', status: 'Pending', remarks: 'Draft placed.', priority: 'High' },
                { id: 2, letterNo: 'GOV/HR/550', date: '2023-11-05', subject: 'Promotion Cases Summary', assignedTo: 'Assistant', status: 'In Progress', remarks: 'Waiting for HR.', priority: 'Medium' },
            ]);

            const staff = ['Secretary', 'Private Secretary (PS)', 'Personal Assistant (PA)', 'Office Assistant', 'Clerk'];
            
            const [newTask, setNewTask] = useState({ letterNo: '', date: '', subject: '', assignedTo: '', remarks: '', priority: 'Medium' });

            // --- Theme Helpers ---
            const theme = {
                bg: darkMode ? 'bg-slate-900' : 'bg-slate-50',
                card: darkMode ? 'bg-slate-800 border-slate-700' : 'bg-white border-slate-200',
                text: darkMode ? 'text-slate-100' : 'text-slate-800',
                subText: darkMode ? 'text-slate-400' : 'text-slate-500',
                input: darkMode ? 'bg-slate-700 border-slate-600 text-white placeholder-slate-400' : 'bg-slate-50 border-slate-300 text-slate-800',
                hover: darkMode ? 'hover:bg-slate-700' : 'hover:bg-slate-50',
                header: darkMode ? 'text-slate-100 border-slate-700' : 'text-slate-800 border-slate-200',
            };

            // --- Helper Functions ---
            const showToast = (message, type = 'success') => {
                setToast({ message, type });
                setTimeout(() => setToast(null), 3000);
            };

            const handleAddTask = (e) => {
                e.preventDefault();
                if (!newTask.subject) return;
                const task = { id: Date.now(), ...newTask, status: 'Pending' };
                setTasks([task, ...tasks]);
                setNewTask({ letterNo: '', date: '', subject: '', assignedTo: '', remarks: '', priority: 'Medium' });
                showToast("New Record Added Successfully");
            };

            const toggleStatus = (id) => {
                setTasks(tasks.map(t => t.id === id ? { ...t, status: t.status === 'Completed' ? 'Pending' : 'Completed' } : t));
                showToast("Task Status Updated");
            };

            const deleteTask = (id) => {
                if(window.confirm("Are you sure you want to delete this official record?")) {
                    setTasks(tasks.filter(t => t.id !== id));
                    showToast("Record Deleted", 'error');
                }
            };

            const copyToClipboard = (task) => {
                const text = `Ref: ${task.letterNo} | Sub: ${task.subject} | Status: ${task.status}`;
                navigator.clipboard.writeText(text);
                showToast("Copied to Clipboard");
            };

            const filteredTasks = tasks.filter(task => {
                const query = searchQuery.toLowerCase();
                return (task.letterNo.toLowerCase().includes(query) || task.subject.toLowerCase().includes(query) || task.assignedTo.toLowerCase().includes(query));
            });

            // --- Views ---
            const renderPendingTasks = () => {
                const pending = tasks.filter(t => t.status !== 'Completed');
                return (
                <div className="space-y-6">
                    <div className={`p-6 rounded-lg shadow-sm border ${theme.card}`}>
                        <h3 className={`text-lg font-bold mb-4 border-b pb-2 flex items-center gap-2 ${darkMode ? 'border-slate-700' : 'border-slate-200'}`}>
                            <Plus size={18} /> New Incoming Task / Dak
                        </h3>
                        <form onSubmit={handleAddTask} className="grid grid-cols-1 md:grid-cols-12 gap-4">
                            <div className="md:col-span-2">
                                <label htmlFor="letterNo" className={`block text-xs font-bold uppercase mb-1 ${theme.subText}`}>Letter No</label>
                                <input id="letterNo" type="text" className={`w-full p-2 border rounded ${theme.input}`} value={newTask.letterNo} onChange={e => setNewTask({...newTask, letterNo: e.target.value})} placeholder="Ref No..." />
                            </div>
                            <div className="md:col-span-2">
                                <label htmlFor="date" className={`block text-xs font-bold uppercase mb-1 ${theme.subText}`}>Date</label>
                                <input id="date" type="date" className={`w-full p-2 border rounded ${theme.input}`} value={newTask.date} onChange={e => setNewTask({...newTask, date: e.target.value})} required />
                            </div>
                            <div className="md:col-span-4">
                                <label htmlFor="subject" className={`block text-xs font-bold uppercase mb-1 ${theme.subText}`}>Subject</label>
                                <input id="subject" type="text" className={`w-full p-2 border rounded ${theme.input}`} value={newTask.subject} onChange={e => setNewTask({...newTask, subject: e.target.value})} placeholder="Subject..." required />
                            </div>
                            <div className="md:col-span-2">
                                <label htmlFor="assignedTo" className={`block text-xs font-bold uppercase mb-1 ${theme.subText}`}>Action By</label>
                                <select id="assignedTo" className={`w-full p-2 border rounded ${theme.input}`} value={newTask.assignedTo} onChange={e => setNewTask({...newTask, assignedTo: e.target.value})}>
                                    <option value="">Select Staff...</option>
                                    {staff.map(s => <option key={s} value={s}>{s}</option>)}
                                </select>
                            </div>
                            <div className="md:col-span-2">
                                <label htmlFor="priority" className={`block text-xs font-bold uppercase mb-1 ${theme.subText}`}>Priority</label>
                                <select id="priority" className={`w-full p-2 border rounded ${theme.input}`} value={newTask.priority} onChange={e => setNewTask({...newTask, priority: e.target.value})}>
                                    <option value="Low">Low</option>
                                    <option value="Medium">Medium</option>
                                    <option value="High">High</option>
                                </select>
                            </div>
                            <div className="md:col-span-12">
                                <label htmlFor="remarks" className="sr-only">Remarks</label>
                                <input id="remarks" type="text" className={`w-full p-2 border rounded ${theme.input}`} value={newTask.remarks} onChange={e => setNewTask({...newTask, remarks: e.target.value})} placeholder="Initial Remarks / Instructions..." />
                            </div>
                            <button type="submit" className="md:col-span-12 bg-slate-800 text-white p-2 rounded hover:bg-slate-700 font-bold transition">Add to Pending List</button>
                        </form>
                    </div>

                    <div className="grid grid-cols-1 gap-4">
                        {pending.length === 0 ? <p className={`text-center py-8 ${theme.subText}`}>No pending tasks. Clean desk!</p> : pending.map(task => (
                            <div key={task.id} className={`p-4 rounded-lg border-l-4 shadow-sm flex flex-col md:flex-row justify-between items-start md:items-center transition ${theme.card} ${task.priority === 'High' ? 'border-l-red-500' : darkMode ? 'border-l-slate-500' : 'border-l-slate-300'}`}>
                                <div className="flex-1">
                                    <div className="flex items-center gap-2 mb-1">
                                        <span className={`text-xs font-bold px-2 py-1 rounded ${darkMode ? 'bg-slate-700 text-slate-300' : 'bg-slate-100 text-slate-600'}`}>{task.letterNo || 'No Ref'}</span>
                                        <span className={`text-xs ${theme.subText}`}>{task.date}</span>
                                        {task.priority === 'High' && <span className="text-xs font-bold text-red-600 bg-red-100 px-2 py-1 rounded flex items-center gap-1"><AlertCircle size={10} /> Urgent</span>}
                                    </div>
                                    <h4 className={`font-bold text-lg ${theme.text}`}>{task.subject}</h4>
                                    <p className={`text-sm mt-1 ${theme.subText}`}>
                                        <span className="font-semibold">Action By:</span> {task.assignedTo || 'Unassigned'} | <span className="italic">"{task.remarks}"</span>
                                    </p>
                                </div>
                                <div className="flex items-center gap-2 mt-4 md:mt-0 no-print">
                                    <button onClick={() => toggleStatus(task.id)} className={`px-4 py-2 rounded border text-sm font-bold flex items-center gap-2 ${darkMode ? 'bg-green-900 text-green-200 border-green-800 hover:bg-green-800' : 'bg-green-50 text-green-700 border-green-200 hover:bg-green-100'}`}>
                                        <CheckCircle size={16} /> Mark Done
                                    </button>
                                    <button onClick={() => copyToClipboard(task)} className={`p-2 hover:text-slate-500 ${theme.subText}`} title="Copy Text"><Copy size={18}/></button>
                                    <button onClick={() => deleteTask(task.id)} className={`p-2 hover:text-red-500 ${theme.subText}`}><Trash2 size={18}/></button>
                                </div>
                            </div>
                        ))}
                    </div>
                </div>
                );
            };

            // 2. Logs View
            const renderLogs = () => (
                <div className="space-y-6">
                    <div className={`p-4 rounded-lg shadow-sm border flex flex-col md:flex-row gap-4 items-center justify-between no-print ${theme.card}`}>
                        <div className="relative w-full md:w-1/2">
                            <Search className={`absolute left-3 top-3 ${theme.subText}`} size={20} />
                            <input type="text" placeholder="Search..." className={`w-full pl-10 p-2 border rounded-lg focus:outline-none ${theme.input}`} value={searchQuery} onChange={(e) => setSearchQuery(e.target.value)} />
                        </div>
                        <div className="flex gap-2">
                            <button onClick={() => window.print()} className="flex items-center gap-2 bg-slate-600 text-white px-4 py-2 rounded shadow hover:bg-slate-700"><Printer size={18} /> Print Log</button>
                        </div>
                    </div>
                    <div className={`rounded-lg shadow-sm border overflow-hidden ${theme.card}`}>
                        <table className="w-full text-left text-sm">
                            <thead className={`font-bold border-b ${darkMode ? 'bg-slate-800 text-slate-200 border-slate-700' : 'bg-slate-100 text-slate-700 border-slate-200'}`}>
                                <tr>
                                    <th className="p-4">Ref No / Date</th>
                                    <th className="p-4">Subject & Remarks</th>
                                    <th className="p-4">Assigned To</th>
                                    <th className="p-4">Status</th>
                                </tr>
                            </thead>
                            <tbody className={`divide-y ${darkMode ? 'divide-slate-700' : 'divide-slate-100'}`}>
                                {filteredTasks.map(task => (
                                    <tr key={task.id} className={theme.hover}>
                                        <td className="p-4 align-top w-32">
                                            <div className={`font-bold ${theme.text}`}>{task.letterNo}</div>
                                            <div className={`text-xs ${theme.subText}`}>{task.date}</div>
                                        </td>
                                        <td className="p-4 align-top">
                                            <div className={`font-medium ${theme.text}`}>{task.subject}</div>
                                            <div className={`text-xs mt-1 italic ${theme.subText}`}>{task.remarks}</div>
                                        </td>
                                        <td className={`p-4 align-top ${theme.subText}`}>{task.assignedTo}</td>
                                        <td className="p-4 align-top">
                                            <span className={`px-2 py-1 rounded text-xs font-bold border ${task.status === 'Completed' ? 'bg-green-100 text-green-800 border-green-200' : 'bg-yellow-100 text-yellow-800 border-yellow-200'}`}>
                                                {task.status}
                                            </span>
                                        </td>
                                    </tr>
                                ))}
                            </tbody>
                        </table>
                    </div>
                </div>
            );

            // 3. Stats Calculation (Fixed Date Logic)
            const today = new Date().toISOString().split('T')[0];
            const completedTodayCount = tasks.filter(t => t.status === 'Completed' && t.date === today).length;

            return (
                <div className={`min-h-screen font-sans transition-colors duration-200 ${theme.bg} ${theme.text}`}>
                    <div className="flex flex-col md:flex-row min-h-screen">
                        {/* Sidebar (Hidden on Print) */}
                        <aside className="w-full md:w-64 bg-slate-900 text-white flex flex-col no-print shadow-xl z-10">
                            <div className="p-6 border-b border-slate-800">
                                <h1 className="text-xl font-bold flex items-center gap-2 text-slate-100"><Shield size={24} /> Secretariat</h1>
                                <p className="text-xs text-slate-400 mt-1 uppercase tracking-wider">Confidential Log</p>
                            </div>
                            <nav className="flex-1 p-4 space-y-2">
                                <button onClick={() => setActiveTab('tasks')} className={`w-full flex items-center gap-3 px-4 py-3 rounded transition ${activeTab === 'tasks' ? 'bg-slate-700' : 'hover:bg-slate-800'}`}><ListTodo size={20} /> Pending Tasks</button>
                                <button onClick={() => setActiveTab('logs')} className={`w-full flex items-center gap-3 px-4 py-3 rounded transition ${activeTab === 'logs' ? 'bg-slate-700' : 'hover:bg-slate-800'}`}><Archive size={20} /> Logs & Search</button>
                                <button onClick={() => setActiveTab('stats')} className={`w-full flex items-center gap-3 px-4 py-3 rounded transition ${activeTab === 'stats' ? 'bg-slate-700' : 'hover:bg-slate-800'}`}><LayoutDashboard size={20} /> Overview</button>
                            </nav>
                            <div className="p-4 border-t border-slate-800">
                                <button onClick={() => setDarkMode(!darkMode)} className="w-full flex items-center justify-center gap-2 bg-slate-800 text-slate-300 py-2 rounded hover:bg-slate-700 transition">
                                    {darkMode ? <Sun size={18} /> : <Moon size={18} />} {darkMode ? 'Light Mode' : 'Dark Mode'}
                                </button>
                            </div>
                        </aside>

                        {/* Main Content */}
                        <main className="flex-1 p-8 overflow-auto">
                            <header className="mb-8 flex justify-between items-center no-print">
                                <h2 className={`text-2xl font-bold border-l-4 pl-4 ${theme.header}`}>{activeTab === 'tasks' ? 'Daily Work Sheet' : activeTab === 'logs' ? 'Official Search Log' : 'Office Overview'}</h2>
                                <div className={`text-sm font-mono ${theme.subText}`}>{new Date().toDateString()}</div>
                            </header>

                            {/* Print Header */}
                            <div className="hidden print:block mb-6 text-center border-b pb-4">
                                <h1 className="text-2xl font-bold text-black">SECRETARIAT TASK LOG</h1>
                                <p className="text-sm text-black">Generated on: {new Date().toLocaleString()}</p>
                            </div>

                            {activeTab === 'tasks' && renderPendingTasks()}
                            {activeTab === 'logs' && renderLogs()}
                            {activeTab === 'stats' && (
                                <div className="grid grid-cols-1 md:grid-cols-3 gap-6">
                                    <div className={`p-6 rounded shadow-sm border-t-4 border-yellow-500 ${theme.card}`}>
                                        <h3 className={`font-bold uppercase text-xs ${theme.subText}`}>Pending Actions</h3>
                                        <p className={`text-4xl font-bold mt-2 ${theme.text}`}>{tasks.filter(t => t.status !== 'Completed').length}</p>
                                    </div>
                                    <div className={`p-6 rounded shadow-sm border-t-4 border-green-500 ${theme.card}`}>
                                        <h3 className={`font-bold uppercase text-xs ${theme.subText}`}>Completed Today</h3>
                                        {/* Fixed logic: Checks if status is completed AND date is today */}
                                        <p className={`text-4xl font-bold mt-2 ${theme.text}`}>{completedTodayCount}</p>
                                    </div>
                                    <div className={`p-6 rounded shadow-sm border-t-4 border-red-500 ${theme.card}`}>
                                        <h3 className={`font-bold uppercase text-xs ${theme.subText}`}>Urgent Priority</h3>
                                        <p className={`text-4xl font-bold mt-2 ${theme.text}`}>{tasks.filter(t => t.priority === 'High' && t.status !== 'Completed').length}</p>
                                    </div>
                                </div>
                            )}
                        </main>
                    </div>

                    {/* Toast Notification Container */}
                    {toast && (
                        <div className={`fixed bottom-5 right-5 z-50 p-4 rounded-lg shadow-lg flex items-center gap-3 text-white transition-all transform toast-enter-active ${toast.type === 'error' ? 'bg-red-600' : 'bg-green-700'}`}>
                            {toast.type === 'error' ? <AlertCircle size={20} /> : <CheckCircle size={20} />}
                            <span className="font-semibold">{toast.message}</span>
                        </div>
                    )}
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
